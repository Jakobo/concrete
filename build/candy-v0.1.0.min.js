/*
 * Candy v0.1.0
 * A sweet, fat free, HTML5 canvas library for all ages.
 * Release Date: 3-27-2016
 * https://github.com/ericdrowell/candy
 * Licensed under the MIT or GPL Version 2 licenses.
 *
 * Copyright (C) 2016 Eric Rowell @ericdrowell
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(){var t={},i=0;t.pixelRatio=function(){return window&&window.navigator&&window.navigator.userAgent&&!/PhantomJS/.test(window.navigator.userAgent)?2:1}(),t.wrappers=[],t.Wrapper=function(e){e||(e={}),this.width=e.width,this.height=e.height,this.layers=[],this.id=i++,this.container=document.createElement("div"),this.container.className="candy-container",this.container.style.display="inline-block",this.container.style.position="relative",this.setSize(this.width,this.height),e.container.innerHTML="",e.container.appendChild(this.container),t.wrappers.push(this)},t.Wrapper.prototype={add:function(t){this.layers.push(t),t.setSize(t.width||this.width,t.height||this.height),t.wrapper=this,this.container.appendChild(t.container)},insert:function(){},setSize:function(t,i){this.width=t,this.height=i,this.container.style.width=this.width+"px",this.container.style.height=this.height+"px"},clear:function(){this.clearScene(),this.clearHit()},clearScene:function(){this.layers.forEach(function(t){t.clearScene()})},clearHit:function(){this.layers.forEach(function(t){t.clearHit()})},getIntersection:function(t,i){var e,n,s,h=this.layers,a=h.length;for(e=a-1;e>=0;e--)if(n=h[e],s=n.hitCanvas.getIntersection(t,i),null!==s)return s;return null},toImage:function(){},toCanvas:function(){},download:function(){},getIndex:function(){var i,e=t.wrappers,n=e.length,s=0;for(s=0;n>s;s++)if(i=e[s],this.id===i.id)return s;return null},destroy:function(){this.layers.forEach(function(t){t.destroy()}),t.wrappers.splice(this.getIndex(),1)}},t.Layer=function(e){e||(e={}),this.width=e.width||0,this.height=e.height||0,this.x=e.x||0,this.y=e.y||0,this.id=i++,this.hitCanvas=new t.HitCanvas,this.sceneCanvas=new t.SceneCanvas,this.container=document.createElement("div"),this.container.className="candy-layer",this.container.style.display="inline-block",this.container.style.position="absolute",this.container.style.left=this.x+"px",this.container.style.top=this.y+"px",this.container.appendChild(this.hitCanvas.canvas),this.container.appendChild(this.sceneCanvas.canvas),this.width&&this.height&&this.setSize(this.width,this.height)},t.Layer.prototype={setX:function(t){this.container.style.left=t+"px"},setY:function(){this.container.style.top=y+"px"},setSize:function(t,i){this.width=t,this.container.style.width=t+"px",this.height=i,this.container.style.height=i+"px",this.sceneCanvas.setSize(t,i),this.hitCanvas.setSize(t,i)},clear:function(){this.sceneCanvas.clear(),this.hitCanvas.clear()},moveUp:function(){var t=this.getIndex(),i=this.wrapper,e=i.layers;t<e.length-1&&(e[t]=e[t+1],e[t+1]=this,i.container.insertBefore(this.container,i.container.children[t+2]))},moveDown:function(){var t=this.getIndex(),i=this.wrapper,e=i.layers;t>0&&(e[t]=e[t-1],e[t-1]=this,i.container.insertBefore(this.container,i.container.children[t-1]))},moveToTop:function(){var t=this.getIndex(),i=this.wrapper,e=i.layers;e.splice(t,1),e.push(this),i.container.appendChild(this.container)},moveToBottom:function(){var t=this.getIndex(),i=this.wrapper,e=i.layers;e.splice(t,1),e.unshift(this),i.container.insertBefore(this.container,i.container.firstChild)},getIndex:function(){var t,i=this.wrapper.layers,e=i.length,n=0;for(n=0;e>n;n++)if(t=i[n],this.id===t.id)return n;return null},destroy:function(){this.wrapper.layers.splice(this.getIndex(),1),this.wrapper.container.removeChild(this.container)}},t.SceneCanvas=function(t){t||(t={}),this.width=t.width||0,this.height=t.height||0,this.id=i++,this.canvas=document.createElement("canvas"),this.canvas.className="candy-scene-canvas",this.canvas.style.display="inline-block",this.canvas.style.position="absolute",this.context=this.canvas.getContext("2d"),this.width&&this.height&&this.setSize(this.width,this.height)},t.SceneCanvas.prototype={setSize:function(e,n){this.width=e,this.height=n,this.id=i++,this.canvas.width=e*t.pixelRatio,this.canvas.style.width=e+"px",this.canvas.height=n*t.pixelRatio,this.canvas.style.height=n+"px",1!==t.pixelRatio&&this.context.scale(t.pixelRatio,t.pixelRatio)},clear:function(){this.context.clearRect(0,0,this.width*t.pixelRatio,this.height*t.pixelRatio)},toImage:function(t){var i=this,e=this.canvas.toDataURL(),n=new Image;n.onload=function(){n.width=i.width,n.height=i.height,t(n)},n.src=e}},t.HitCanvas=function(t){t||(t={}),this.width=t.width||0,this.height=t.height||0,this.canvas=document.createElement("canvas"),this.canvas.className="candy-hit-canvas",this.canvas.style.display="none",this.canvas.style.position="relative",this.context=this.canvas.getContext("2d"),this.hitColorIndex=0,this.keyToColor={},this.colorToKey={},this.width&&this.height&&this.setSize(this.width,this.height)},t.HitCanvas.prototype={setSize:function(t,i){this.width=t,this.height=i,this.canvas.width=t,this.canvas.style.width=t+"px",this.canvas.height=i,this.canvas.style.height=i+"px"},clear:function(){this.context.clearRect(0,0,this.width,this.height)},getIntersection:function(t,i){var e,n,s,h,a,o,r;return e=this.context.getImageData(Math.round(t),Math.round(i),1,1).data,n=e[0],h=e[1],s=e[2],a=e[3],o=this.rgbToInt(n,h,s),r=this.colorToKey[o],void 0!==r&&255===a?r:null},addKey:function(t){var i;this.keyToColor[t]||(i=this.hitColorIndex++,this.colorToKey[i]=t,this.keyToColor[t]=i)},rgbToInt:function(t,i,e){return(t<<16)+(i<<8)+e},getColorFromKey:function(t){for(var i=this.keyToColor[t].toString(16);i.length<6;)i="0"+i;return"#"+i}},window.Candy=t}();